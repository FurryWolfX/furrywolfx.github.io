import{_ as s,c as a,o as i,a4 as n}from"./chunks/framework.CWaimgAe.js";const g=JSON.parse('{"title":"Spark 学习日记（初探）","description":"","frontmatter":{"title":"Spark 学习日记（初探）","catalog":true,"date":"2020-06-16T16:50:24.000Z","subtitle":null,"header-img":null,"tags":["Spark"]},"headers":[],"relativePath":"docs/backend/spark-note.md","filePath":"docs/backend/spark-note.md"}'),p={name:"docs/backend/spark-note.md"},e=n(`<h1 id="spark-学习日记-初探" tabindex="-1">Spark 学习日记（初探） <a class="header-anchor" href="#spark-学习日记-初探" aria-label="Permalink to &quot;Spark 学习日记（初探）&quot;">​</a></h1><h2 id="历史" tabindex="-1">历史 <a class="header-anchor" href="#历史" aria-label="Permalink to &quot;历史&quot;">​</a></h2><h3 id="hadoop-1-x" tabindex="-1">hadoop 1.x <a class="header-anchor" href="#hadoop-1-x" aria-label="Permalink to &quot;hadoop 1.x&quot;">​</a></h3><p><code>HDFS</code>：用 <code>NameNode</code> 管理 <code>DataNode</code>。 <code>Map-Reduce</code>：用 <code>JobTracker</code> 管理（调度） <code>TaskTracker</code></p><h3 id="hadoop-1-x-map-reduce-的缺点" tabindex="-1">hadoop 1.x Map-Reduce 的缺点 <a class="header-anchor" href="#hadoop-1-x-map-reduce-的缺点" aria-label="Permalink to &quot;hadoop 1.x Map-Reduce 的缺点&quot;">​</a></h3><p><code>Map-Reduce</code> 是基于数据集的计算，是面向数据的。</p><ol><li>基本的运算规则从介质中获取，计算后再存储到介质中。所以主要应用于一次性计算。在当前的大数据环境中是无法接受的。不适合数据挖掘和机器学习这样的迭代计算。</li><li>基于文件，<code>IO</code> 效率慢。</li><li>和 <code>hadoop</code> 紧密耦合，无法替换。</li></ol><h3 id="hadoop-2-x-yarn-的出现" tabindex="-1">hadoop 2.x Yarn 的出现 <a class="header-anchor" href="#hadoop-2-x-yarn-的出现" aria-label="Permalink to &quot;hadoop 2.x Yarn 的出现&quot;">​</a></h3><ul><li><p>RM(ResourceManager)</p></li><li><p>NM(NodeManager)</p></li><li><p>AM(ApplicationMaster)</p></li><li><p>RM -&gt; NM -&gt; Container -&gt; Task</p></li><li><p>RM -&gt; AM -&gt; Driver -&gt; Task</p></li></ul><p><img src="https://imgs-1251264059.cos.ap-chengdu.myqcloud.com/spark-note/6e7da566-b727-4143-8208-4155ed330775.png" alt="UTOOLS1592321344280.png"></p><h3 id="spark-的出现是为了改善-hadoop-1-x-的不足" tabindex="-1">Spark 的出现是为了改善 hadoop 1.x 的不足 <a class="header-anchor" href="#spark-的出现是为了改善-hadoop-1-x-的不足" aria-label="Permalink to &quot;Spark 的出现是为了改善 hadoop 1.x 的不足&quot;">​</a></h3><p>基于内存，使用 Scala 语言，适合迭代计算</p><p><img src="https://imgs-1251264059.cos.ap-chengdu.myqcloud.com/spark-note/881e7d36-48a9-48ba-8103-f49da3e5ca15.png" alt="UTOOLS1592321615415.png"></p><p>HDFS + Yarn + Spark</p><h2 id="spark-模块" tabindex="-1">Spark 模块 <a class="header-anchor" href="#spark-模块" aria-label="Permalink to &quot;Spark 模块&quot;">​</a></h2><ul><li>Spark Core</li><li>Spark SQL</li><li>Spark Streaming</li><li>Spark MLib</li><li>Spark GraphX</li></ul><h2 id="sbt-管理-jar-包依赖" tabindex="-1">SBT 管理 jar 包依赖 <a class="header-anchor" href="#sbt-管理-jar-包依赖" aria-label="Permalink to &quot;SBT 管理 jar 包依赖&quot;">​</a></h2><p>可以使用下面的方式来定义一个依赖，其中 groupId，artifactId 和 revision 都是字符串：</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">libraryDependencies += groupId % artifactId % revision</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>使用国内镜像加速：</p><p>创建修改 <code>~/.sbt/repositories</code> 加入阿里的镜像</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">[repositories]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">local</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aliyun: https://maven.aliyun.com/repository/public</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="spark-统计单词数量" tabindex="-1">Spark 统计单词数量 <a class="header-anchor" href="#spark-统计单词数量" aria-label="Permalink to &quot;Spark 统计单词数量&quot;">​</a></h2><p>新建一个 sbt 项目</p><p>sbt:</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;spark&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">version := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scalaVersion := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.11.12&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">libraryDependencies += </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;org.apache.spark&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %% </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;spark-core&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> % </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.4.6&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">libraryDependencies += </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;org.apache.spark&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %% </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;spark-sql&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> % </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2.4.6&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>input:</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Hello World</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Hello Scala</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Hello Spark</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>SparkWordCount:</p><div class="language-scala vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">scala</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> org</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apache</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spark</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.{</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SparkConf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SparkContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">object</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SparkWordCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">args</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Array</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> logFile</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;input&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> // Should be some file on your system</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> conf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SparkConf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conf.setAppName(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SparkWordCount&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置应用名称</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    conf.setMaster(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;local[1]&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 设置本地模式，1个进程</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> sc</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SparkContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(conf)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sc.textFile(logFile, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).cache()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> words</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data.flatMap(_.split(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> wordOnce</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> words.map((_, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    val</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> wordWithCountList</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> wordOnce.reduceByKey((a, b) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> b)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    wordWithCountList.foreach(println)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    sc.stop()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>输出：</p><div class="language-ini vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Hello,3)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(World,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Scala,1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Spark,1)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="spark-和-yarn-联合使用" tabindex="-1">Spark 和 Yarn 联合使用 <a class="header-anchor" href="#spark-和-yarn-联合使用" aria-label="Permalink to &quot;Spark 和 Yarn 联合使用&quot;">​</a></h2><p>在 spark 目录中修改 <code>spark-env.sh</code></p><p>添加 <code>YARN_CONF_DIR=/xxx/hadoop/etc/hadoop</code></p>`,35),l=[e];function t(h,r,k,d,o,c){return i(),a("div",null,l)}const u=s(p,[["render",t]]);export{g as __pageData,u as default};
