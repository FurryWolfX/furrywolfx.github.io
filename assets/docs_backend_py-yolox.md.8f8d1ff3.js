import{_ as s,o as n,c as a,V as l}from"./chunks/framework.4acca30d.js";const C=JSON.parse('{"title":"使用 Yolox 进行目标检测训练","description":"","frontmatter":{"title":"使用 Yolox 进行目标检测训练","date":"2023-07-23T12:00:00.000Z","tags":["Python"]},"headers":[],"relativePath":"docs/backend/py-yolox.md","filePath":"docs/backend/py-yolox.md"}'),p={name:"docs/backend/py-yolox.md"},o=l(`<h1 id="使用-yolox-进行目标检测训练" tabindex="-1">使用 Yolox 进行目标检测训练 <a class="header-anchor" href="#使用-yolox-进行目标检测训练" aria-label="Permalink to &quot;使用 Yolox 进行目标检测训练&quot;">​</a></h1><h2 id="第一步-使用-labelme-进行图片标注" tabindex="-1">第一步：使用 labelme 进行图片标注 <a class="header-anchor" href="#第一步-使用-labelme-进行图片标注" aria-label="Permalink to &quot;第一步：使用 labelme 进行图片标注&quot;">​</a></h2><p>生成如下结构的文件：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">labelme</span></span>
<span class="line"><span style="color:#A6ACCD;">- x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">- x.json</span></span>
<span class="line"><span style="color:#A6ACCD;">- y.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">- y.json</span></span>
<span class="line"><span style="color:#A6ACCD;">- ...</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="第二步-数据集转换到-coco-格式" tabindex="-1">第二步：数据集转换到 coco 格式 <a class="header-anchor" href="#第二步-数据集转换到-coco-格式" aria-label="Permalink to &quot;第二步：数据集转换到 coco 格式&quot;">​</a></h2><p>使用 <code>tools/labelme2coco.py</code> 将 <code>labelme</code> 格式转换成 <code>coco</code> 格式</p><div class="language-py line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/usr/bin/env python</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> argparse</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> collections</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> datetime</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> glob</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> json</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> osp</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> sys</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> uuid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> imgviz</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> numpy </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> np</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> labelme</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> yolox</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> COCO_CLASSES</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> pycocotools</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mask</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">except</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ImportError</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Please install pycocotools:</span><span style="color:#A6ACCD;">\\n\\n</span><span style="color:#C3E88D;">    pip install pycocotools</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    sys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">    parser </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> argparse</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">ArgumentParser</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">formatter_class</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">argparse</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">ArgumentDefaultsHelpFormatter</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_argument</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">input_dir</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">help</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">input annotated directory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_argument</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">output_dir</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">help</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">output dataset directory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># parser.add_argument(&quot;--labels&quot;, help=&quot;labels file&quot;, required=True)</span></span>
<span class="line"><span style="color:#A6ACCD;">    parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">add_argument</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">--noviz</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">help</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">no visualization</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">action</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">store_true</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    args </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> parser</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse_args</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exists</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Output directory already exists:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        sys</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exit</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">makedirs</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">makedirs</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">JPEGImages</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">noviz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">makedirs</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Visualization</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Creating dataset:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    now </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> datetime</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">datetime</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">now</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">info</span><span style="color:#89DDFF;">=</span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">description</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">version</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">year</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">now</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">year</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">contributor</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#A6ACCD;font-style:italic;">date_created</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">now</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">strftime</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">%Y-%m-</span><span style="color:#F78C6C;">%d</span><span style="color:#C3E88D;"> %H:%M:%S.</span><span style="color:#F78C6C;">%f</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">),</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">licenses</span><span style="color:#89DDFF;">=[</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">images</span><span style="color:#89DDFF;">=[</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#676E95;font-style:italic;"># license, url, file_name, height, width, date_captured, id</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">type</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">instances</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">annotations</span><span style="color:#89DDFF;">=[</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#676E95;font-style:italic;"># segmentation, area, iscrowd, image_id, bbox, category_id, id</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#A6ACCD;font-style:italic;">categories</span><span style="color:#89DDFF;">=[</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#676E95;font-style:italic;"># supercategory, id, name</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">    </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    class_name_to_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#A6ACCD;">    labels </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">list</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">COCO_CLASSES</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    labels</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">insert</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__ignore__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> i</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> line </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enumerate</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">labels</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        class_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> i </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># starts with -1</span></span>
<span class="line"><span style="color:#A6ACCD;">        class_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> line</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">strip</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> class_id </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">assert</span><span style="color:#A6ACCD;"> class_name </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__ignore__</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">continue</span></span>
<span class="line"><span style="color:#A6ACCD;">        class_name_to_id</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">class_name</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> class_id</span></span>
<span class="line"><span style="color:#A6ACCD;">        data</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">categories</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">supercategory</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">class_id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">name</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">class_name</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    out_ann_file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">annotations.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    label_files </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> glob</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">glob</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">input_dir</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> image_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> filename </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">enumerate</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">label_files</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Generating dataset from:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        label_file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> labelme</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">LabelFile</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">filename</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">filename</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        base </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">splitext</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">basename</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">filename</span><span style="color:#89DDFF;">))[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">        out_img_file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">JPEGImages</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> base </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.jpg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        img </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> labelme</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">utils</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">img_data_to_arr</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">label_file</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">imageData</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        imgviz</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">imsave</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">out_img_file</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> img</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        data</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">images</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">license</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">url</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">file_name</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">relpath</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">out_img_file</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">out_ann_file</span><span style="color:#89DDFF;">)),</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">height</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">img</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">width</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">img</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">date_captured</span><span style="color:#89DDFF;">=None,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">image_id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        masks </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># for area</span></span>
<span class="line"><span style="color:#A6ACCD;">        segmentations </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> collections</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defaultdict</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">list</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;"># for segmentation</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> shape </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> label_file</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shapes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            points </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> shape</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">points</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">            label </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> shape</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">label</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">            group_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">group_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            shape_type </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> shape</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">shape_type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">polygon</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            mask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> labelme</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">utils</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">shape_to_mask</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                img</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">shape</span><span style="color:#89DDFF;">[:</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> points</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> shape_type</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> group_id </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">                group_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> uuid</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">uuid1</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            instance </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">label</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> group_id</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> instance </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> masks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                masks</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">instance</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> masks</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">instance</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> mask</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                masks</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">instance</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> mask</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> shape_type </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rectangle</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y2</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> points</span></span>
<span class="line"><span style="color:#A6ACCD;">                x1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sorted</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">x1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> x2</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">                y1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y2 </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">sorted</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">y1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> y2</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">                points </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">x1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> x1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y2</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> shape_type </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">circle</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y1</span><span style="color:#89DDFF;">),</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">x2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> y2</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> points</span></span>
<span class="line"><span style="color:#A6ACCD;">                r </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">linalg</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">norm</span><span style="color:#89DDFF;">([</span><span style="color:#82AAFF;">x2 </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;"> x1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> y2 </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;"> y1</span><span style="color:#89DDFF;">])</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># r(1-cos(a/2))&lt;x, a=2*pi/N =&gt; N&gt;pi/arccos(1-x/r)</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;"># x: tolerance of the gap between the arc and the line segment</span></span>
<span class="line"><span style="color:#A6ACCD;">                n_points_circle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">max</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">int</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">pi</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">arccos</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">-</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">1</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;"> r</span><span style="color:#89DDFF;">)),</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">12</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                i </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">arange</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">n_points_circle</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                x </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> x1 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> r </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sin</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">pi</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;"> n_points_circle </span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;"> i</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                y </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> y1 </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> r </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cos</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">pi</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">/</span><span style="color:#82AAFF;"> n_points_circle </span><span style="color:#89DDFF;">*</span><span style="color:#82AAFF;"> i</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                points </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stack</span><span style="color:#89DDFF;">((</span><span style="color:#82AAFF;">x</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> y</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;font-style:italic;">axis</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">flatten</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">tolist</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                points </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">asarray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">points</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">flatten</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">tolist</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            segmentations</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">instance</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">points</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        segmentations </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">segmentations</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> instance</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mask </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> masks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">items</span><span style="color:#89DDFF;">():</span></span>
<span class="line"><span style="color:#A6ACCD;">            cls_name</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> group_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> instance</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> cls_name </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> class_name_to_id</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">continue</span></span>
<span class="line"><span style="color:#A6ACCD;">            cls_id </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> class_name_to_id</span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">cls_name</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            mask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> np</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">asfortranarray</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">mask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">astype</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">np</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">uint8</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">            mask </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> pycocotools</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encode</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">mask</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            area </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">float</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">pycocotools</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">area</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">mask</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">            bbox </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> pycocotools</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">mask</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toBbox</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">mask</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">flatten</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">tolist</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            data</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">annotations</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">append</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#FFCB6B;">dict</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">annotations</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]),</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">image_id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">image_id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">category_id</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">cls_id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">segmentation</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">segmentations</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">instance</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">area</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">area</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">bbox</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">bbox</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">iscrowd</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">noviz</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">            viz </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> img</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> masks</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">                labels</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> captions</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> masks </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">zip</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#89DDFF;">*[</span></span>
<span class="line"><span style="color:#82AAFF;">                        </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">class_name_to_id</span><span style="color:#89DDFF;">[</span><span style="color:#82AAFF;">cnm</span><span style="color:#89DDFF;">],</span><span style="color:#82AAFF;"> cnm</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> msk</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#82AAFF;">                        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">cnm</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> gid</span><span style="color:#89DDFF;">),</span><span style="color:#82AAFF;"> msk </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#82AAFF;"> masks</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">items</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#82AAFF;">                        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#82AAFF;"> cnm </span><span style="color:#89DDFF;">in</span><span style="color:#82AAFF;"> class_name_to_id</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                viz </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> imgviz</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">instances2rgb</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">image</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">img</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">labels</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">labels</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">masks</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">masks</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">captions</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">captions</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">font_size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">15</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                    </span><span style="color:#A6ACCD;font-style:italic;">line_width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            out_viz_file </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> osp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                args</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">output_dir</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Visualization</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> base </span><span style="color:#89DDFF;">+</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.jpg</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">            imgviz</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">io</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">imsave</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">out_viz_file</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> viz</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">out_ann_file</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">w</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> f</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">        json</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dump</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">data</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> f</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">main</span><span style="color:#89DDFF;">()</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br></div></div><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">coco_cata</span></span>
<span class="line"><span style="color:#A6ACCD;">- JPEGImages</span></span>
<span class="line"><span style="color:#A6ACCD;">  - x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">  - y.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">- Visualization</span></span>
<span class="line"><span style="color:#A6ACCD;">  - x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">  - y.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">- annotations.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>最后整理成如下格式：</p><div class="language- line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">coco</span></span>
<span class="line"><span style="color:#A6ACCD;">- annotations</span></span>
<span class="line"><span style="color:#A6ACCD;">  - annotations.json</span></span>
<span class="line"><span style="color:#A6ACCD;">- train2017</span></span>
<span class="line"><span style="color:#A6ACCD;">  - JPEGImages</span></span>
<span class="line"><span style="color:#A6ACCD;">    - x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">    - y.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">  - Visualization</span></span>
<span class="line"><span style="color:#A6ACCD;">    - x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">    - y.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">- val2017</span></span>
<span class="line"><span style="color:#A6ACCD;">  - JPEGImages</span></span>
<span class="line"><span style="color:#A6ACCD;">    - x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">    - y.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">  - Visualization</span></span>
<span class="line"><span style="color:#A6ACCD;">    - x.jpg</span></span>
<span class="line"><span style="color:#A6ACCD;">    - y.jpg</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h2 id="第三步-修改-coco-classes" tabindex="-1">第三步：修改 coco classes <a class="header-anchor" href="#第三步-修改-coco-classes" aria-label="Permalink to &quot;第三步：修改 coco classes&quot;">​</a></h2><p><code>yolox/data/datasets/coco_classes.py</code></p><div class="language-py line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/usr/bin/env python3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -*- coding:utf-8 -*-</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Copyright (c) Megvii, Inc. and its affiliates.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">COCO_CLASSES </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">xxx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">yyy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="第四步-修改模型" tabindex="-1">第四步：修改模型 <a class="header-anchor" href="#第四步-修改模型" aria-label="Permalink to &quot;第四步：修改模型&quot;">​</a></h2><p><code>exps/example/custom/yolox_s.py</code></p><div class="language-py line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#!/usr/bin/env python3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># -*- coding:utf-8 -*-</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Copyright (c) Megvii, Inc. and its affiliates.</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> yolox</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">data </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> COCO_CLASSES</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> yolox</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exp </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> Exp </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#A6ACCD;"> MyExp</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Exp</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">MyExp</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#FFCB6B;">super</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">Exp</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">depth</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.33</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">width</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.50</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">exp_name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">realpath</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">__file__</span><span style="color:#89DDFF;">))[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># Define yourself dataset path</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data_dir</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">r</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">D:\\Work</span><span style="color:#A6ACCD;">\\a</span><span style="color:#C3E88D;">i</span><span style="color:#A6ACCD;">\\Y</span><span style="color:#C3E88D;">OLOX\\datasets</span><span style="color:#A6ACCD;">\\c</span><span style="color:#C3E88D;">oco</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">train_ann</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">annotations.json</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">val_ann</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">annotations.json</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">num_classes</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">len</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">COCO_CLASSES</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">max_epoch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">data_num_workers</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">eval_interval</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="第五步-训练模型" tabindex="-1">第五步：训练模型 <a class="header-anchor" href="#第五步-训练模型" aria-label="Permalink to &quot;第五步：训练模型&quot;">​</a></h2><p>使用 <code>tools/train.py</code> 执行训练。</p>`,18),e=[o];function c(t,r,F,D,y,A){return n(),a("div",null,e)}const b=s(p,[["render",c]]);export{C as __pageData,b as default};
