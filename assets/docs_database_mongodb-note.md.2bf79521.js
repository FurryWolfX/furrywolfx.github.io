import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.a1e87edc.js";const F=JSON.parse('{"title":"mongodb 使用笔记","description":"","frontmatter":{"title":"mongodb 使用笔记","catalog":true,"date":"2018-08-25T16:50:24.000Z","subtitle":null,"header-img":null,"tags":["JavaScript","NodeJS"]},"headers":[],"relativePath":"docs/database/mongodb-note.md","filePath":"docs/database/mongodb-note.md"}'),p={name:"docs/database/mongodb-note.md"},o=l(`<h1 id="mongodb-使用笔记" tabindex="-1">mongodb 使用笔记 <a class="header-anchor" href="#mongodb-使用笔记" aria-label="Permalink to &quot;mongodb 使用笔记&quot;">​</a></h1><h2 id="linux-下安装-mongodb" tabindex="-1">linux 下安装 mongodb <a class="header-anchor" href="#linux-下安装-mongodb" aria-label="Permalink to &quot;linux 下安装 mongodb&quot;">​</a></h2><p>下载二进制文件后，终端输入：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">## 不使用配制文件启动</span></span>
<span class="line"><span style="color:#B392F0;">./bin/mongod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-auth</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--dbpath=/data/mongodb/data</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--logpath=/data/mongodb/logs</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--logappend</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--port=27017</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--fork</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">## 不使用配制文件启动</span></span>
<span class="line"><span style="color:#6F42C1;">./bin/mongod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-auth</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--dbpath=/data/mongodb/data</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--logpath=/data/mongodb/logs</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--logappend</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--port=27017</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--fork</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="补充" tabindex="-1">补充 <a class="header-anchor" href="#补充" aria-label="Permalink to &quot;补充&quot;">​</a></h3><p>官方提供 <code>deb</code> 等二进制包，可以使用。</p><h3 id="修改配制文件" tabindex="-1">修改配制文件 <a class="header-anchor" href="#修改配制文件" aria-label="Permalink to &quot;修改配制文件&quot;">​</a></h3><p>修改 <code>/etc/mongod.conf</code></p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">## mongod.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## for documentation of all options, see:</span></span>
<span class="line"><span style="color:#6A737D;">##   http://docs.mongodb.org/manual/reference/configuration-options/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## Where and how to store data.</span></span>
<span class="line"><span style="color:#B392F0;">storage:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">dbPath:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/junlsoft/mongodb/data</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">journal:</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">enabled:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#6A737D;">##  engine:</span></span>
<span class="line"><span style="color:#6A737D;">##  mmapv1:</span></span>
<span class="line"><span style="color:#6A737D;">##  wiredTiger:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## where to write logging data.</span></span>
<span class="line"><span style="color:#B392F0;">systemLog:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">destination:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">file</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">logAppend:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">path:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/home/junlsoft/mongodb/logs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## network interfaces</span></span>
<span class="line"><span style="color:#B392F0;">net:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">port:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">27017</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">bindIp:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.0</span><span style="color:#9ECBFF;">.0.0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## how the process runs</span></span>
<span class="line"><span style="color:#B392F0;">processManagement:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">timeZoneInfo:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/usr/share/zoneinfo</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">fork:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0;">security:</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#B392F0;">authorization:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">enabled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#operationProfiling:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#replication:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#sharding:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">### Enterprise-Only Options:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#auditLog:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#snmp:</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">## mongod.conf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## for documentation of all options, see:</span></span>
<span class="line"><span style="color:#6A737D;">##   http://docs.mongodb.org/manual/reference/configuration-options/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## Where and how to store data.</span></span>
<span class="line"><span style="color:#6F42C1;">storage:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">dbPath:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/junlsoft/mongodb/data</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">journal:</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">enabled:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#6A737D;">##  engine:</span></span>
<span class="line"><span style="color:#6A737D;">##  mmapv1:</span></span>
<span class="line"><span style="color:#6A737D;">##  wiredTiger:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## where to write logging data.</span></span>
<span class="line"><span style="color:#6F42C1;">systemLog:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">destination:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">file</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">logAppend:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">path:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/home/junlsoft/mongodb/logs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## network interfaces</span></span>
<span class="line"><span style="color:#6F42C1;">net:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">port:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">27017</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">bindIp:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.0</span><span style="color:#032F62;">.0.0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">## how the process runs</span></span>
<span class="line"><span style="color:#6F42C1;">processManagement:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">timeZoneInfo:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/usr/share/zoneinfo</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">fork:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;">security:</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6F42C1;">authorization:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">enabled</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#operationProfiling:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#replication:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#sharding:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">### Enterprise-Only Options:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#auditLog:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">#snmp:</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="使用配置文件启动" tabindex="-1">使用配置文件启动 <a class="header-anchor" href="#使用配置文件启动" aria-label="Permalink to &quot;使用配置文件启动&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mongod</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--config</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/etc/mongod.conf</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mongod</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--config</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/etc/mongod.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="gui-工具推荐" tabindex="-1">GUI 工具推荐 <a class="header-anchor" href="#gui-工具推荐" aria-label="Permalink to &quot;GUI 工具推荐&quot;">​</a></h2><ol><li>robo3t（轻量，免费）</li><li>3t studio（重量，收费）</li><li>dbKoda（重量，免费）</li></ol><h2 id="备份与恢复" tabindex="-1">备份与恢复 <a class="header-anchor" href="#备份与恢复" aria-label="Permalink to &quot;备份与恢复&quot;">​</a></h2><p>利用 <code>bin</code> 下的 <code>mongodump</code> 和 <code>mongorestore</code></p><h3 id="备份" tabindex="-1">备份 <a class="header-anchor" href="#备份" aria-label="Permalink to &quot;备份&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@localhost bin]## ./mongodump -d my_mongodb</span></span>
<span class="line"><span style="color:#B392F0;">connected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span></span>
<span class="line"><span style="color:#B392F0;">DATABASE:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my_mongodb</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;">     </span><span style="color:#9ECBFF;">dump/my_mongodb</span></span>
<span class="line"><span style="color:#B392F0;">my_mongodb.system.indexes</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dump/my_mongodb/system.indexes.bson</span></span>
<span class="line"><span style="color:#B392F0;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objects</span></span>
<span class="line"><span style="color:#B392F0;">my_mongodb.user</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dump/my_mongodb/user.bson</span></span>
<span class="line"><span style="color:#B392F0;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objects</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@localhost bin]## ll</span></span>
<span class="line"><span style="color:#B392F0;">总计</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">67648</span></span>
<span class="line"><span style="color:#B392F0;">-rwxr-xr-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">7508756</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2011</span><span style="color:#9ECBFF;">-04-06</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">bsondump</span></span>
<span class="line"><span style="color:#B392F0;">drwxr-xr-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">4096</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#9ECBFF;">-10</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">23</span><span style="color:#9ECBFF;">:54</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dump</span></span>
<span class="line"><span style="color:#B392F0;">-rwxr-xr-x</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2978016</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">2011</span><span style="color:#9ECBFF;">-04-06</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">mongo</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@localhost bin]## ./mongodump -d my_mongodb</span></span>
<span class="line"><span style="color:#6F42C1;">connected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span></span>
<span class="line"><span style="color:#6F42C1;">DATABASE:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my_mongodb</span><span style="color:#24292E;">     </span><span style="color:#032F62;">to</span><span style="color:#24292E;">     </span><span style="color:#032F62;">dump/my_mongodb</span></span>
<span class="line"><span style="color:#6F42C1;">my_mongodb.system.indexes</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dump/my_mongodb/system.indexes.bson</span></span>
<span class="line"><span style="color:#6F42C1;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objects</span></span>
<span class="line"><span style="color:#6F42C1;">my_mongodb.user</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dump/my_mongodb/user.bson</span></span>
<span class="line"><span style="color:#6F42C1;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objects</span></span>
<span class="line"><span style="color:#24292E;">[root@localhost bin]## ll</span></span>
<span class="line"><span style="color:#6F42C1;">总计</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">67648</span></span>
<span class="line"><span style="color:#6F42C1;">-rwxr-xr-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">7508756</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2011</span><span style="color:#032F62;">-04-06</span><span style="color:#24292E;"> </span><span style="color:#032F62;">bsondump</span></span>
<span class="line"><span style="color:#6F42C1;">drwxr-xr-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">3</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;">    </span><span style="color:#005CC5;">4096</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#032F62;">-10</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">23</span><span style="color:#032F62;">:54</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dump</span></span>
<span class="line"><span style="color:#6F42C1;">-rwxr-xr-x</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2978016</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">2011</span><span style="color:#032F62;">-04-06</span><span style="color:#24292E;"> </span><span style="color:#032F62;">mongo</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="恢复" tabindex="-1">恢复 <a class="header-anchor" href="#恢复" aria-label="Permalink to &quot;恢复&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[root@localhost bin]## ./mongorestore -d my_mongodb my_mongodb_dump/</span></span>
<span class="line"><span style="color:#B392F0;">connected</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">to:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">127.0</span><span style="color:#9ECBFF;">.0.1</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my_mongodb_dump/my_mongodb/user.bson</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">going</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">into</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace</span><span style="color:#E1E4E8;"> [my_mongodb.user]</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objects</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">found</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">my_mongodb_dump/my_mongodb/system.indexes.bson</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">going</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">into</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">namespace</span><span style="color:#E1E4E8;"> [my_mongodb.system.indexes]</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">name:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;_id_&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">ns:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;my_mongodb.user&quot;,</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">key:</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">{</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">_id:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">},</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">v:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">}</span></span>
<span class="line"><span style="color:#B392F0;">Wed</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">Apr</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">11</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#9ECBFF;">:03:03</span><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">objects</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">found</span></span>
<span class="line"><span style="color:#E1E4E8;">[root@localhost bin]#</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[root@localhost bin]## ./mongorestore -d my_mongodb my_mongodb_dump/</span></span>
<span class="line"><span style="color:#6F42C1;">connected</span><span style="color:#24292E;"> </span><span style="color:#032F62;">to:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">127.0</span><span style="color:#032F62;">.0.1</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my_mongodb_dump/my_mongodb/user.bson</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;">      </span><span style="color:#032F62;">going</span><span style="color:#24292E;"> </span><span style="color:#032F62;">into</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace</span><span style="color:#24292E;"> [my_mongodb.user]</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objects</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;"> </span><span style="color:#032F62;">my_mongodb_dump/my_mongodb/system.indexes.bson</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;">      </span><span style="color:#032F62;">going</span><span style="color:#24292E;"> </span><span style="color:#032F62;">into</span><span style="color:#24292E;"> </span><span style="color:#032F62;">namespace</span><span style="color:#24292E;"> [my_mongodb.system.indexes]</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">name:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;_id_&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">ns:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;my_mongodb.user&quot;,</span><span style="color:#24292E;"> </span><span style="color:#032F62;">key:</span><span style="color:#24292E;"> </span><span style="color:#032F62;">{</span><span style="color:#24292E;"> </span><span style="color:#032F62;">_id:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">},</span><span style="color:#24292E;"> </span><span style="color:#032F62;">v:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;"> </span><span style="color:#032F62;">}</span></span>
<span class="line"><span style="color:#6F42C1;">Wed</span><span style="color:#24292E;"> </span><span style="color:#032F62;">Apr</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">11</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#032F62;">:03:03</span><span style="color:#24292E;">      </span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> </span><span style="color:#032F62;">objects</span><span style="color:#24292E;"> </span><span style="color:#032F62;">found</span></span>
<span class="line"><span style="color:#24292E;">[root@localhost bin]#</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="导出" tabindex="-1">导出 <a class="header-anchor" href="#导出" aria-label="Permalink to &quot;导出&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">## -d：数据库名</span></span>
<span class="line"><span style="color:#6A737D;">## -c：集合名称</span></span>
<span class="line"><span style="color:#6A737D;">## -o : 导出数据文件的路径</span></span>
<span class="line"><span style="color:#6A737D;">## -type : 导出数据类型，默认json</span></span>
<span class="line"><span style="color:#B392F0;">mongoexport</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dbname</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collectionname</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-o</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">filepath</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">json/csv</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">field</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">## -d：数据库名</span></span>
<span class="line"><span style="color:#6A737D;">## -c：集合名称</span></span>
<span class="line"><span style="color:#6A737D;">## -o : 导出数据文件的路径</span></span>
<span class="line"><span style="color:#6A737D;">## -type : 导出数据类型，默认json</span></span>
<span class="line"><span style="color:#6F42C1;">mongoexport</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dbname</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collectionname</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-o</span><span style="color:#24292E;"> </span><span style="color:#032F62;">filepath</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">json/csv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">field</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="导入" tabindex="-1">导入 <a class="header-anchor" href="#导入" aria-label="Permalink to &quot;导入&quot;">​</a></h3><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">## -d：数据库名</span></span>
<span class="line"><span style="color:#6A737D;">## -c：集合名称</span></span>
<span class="line"><span style="color:#6A737D;">## --file : 选择导入的文件</span></span>
<span class="line"><span style="color:#6A737D;">## -type : 文件类型，默认json</span></span>
<span class="line"><span style="color:#6A737D;">## -f : 字段，type为csv是必须设置此项</span></span>
<span class="line"><span style="color:#B392F0;">mongoimport</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-d</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">dbname</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-c</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">collectionname</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--file</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">filename</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--headerline</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">--type</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">json/csv</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-f</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">field</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">## -d：数据库名</span></span>
<span class="line"><span style="color:#6A737D;">## -c：集合名称</span></span>
<span class="line"><span style="color:#6A737D;">## --file : 选择导入的文件</span></span>
<span class="line"><span style="color:#6A737D;">## -type : 文件类型，默认json</span></span>
<span class="line"><span style="color:#6A737D;">## -f : 字段，type为csv是必须设置此项</span></span>
<span class="line"><span style="color:#6F42C1;">mongoimport</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-d</span><span style="color:#24292E;"> </span><span style="color:#032F62;">dbname</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-c</span><span style="color:#24292E;"> </span><span style="color:#032F62;">collectionname</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--file</span><span style="color:#24292E;"> </span><span style="color:#032F62;">filename</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--headerline</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">--type</span><span style="color:#24292E;"> </span><span style="color:#032F62;">json/csv</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-f</span><span style="color:#24292E;"> </span><span style="color:#032F62;">field</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="新建用户无法授权登录" tabindex="-1">新建用户无法授权登录 <a class="header-anchor" href="#新建用户无法授权登录" aria-label="Permalink to &quot;新建用户无法授权登录&quot;">​</a></h2><p>千万不要相信 <code>robo3t</code> 自带的权限可视化操作，这是元凶。 千万不要相信 <code>robo3t</code> 自带的权限可视化操作，这是元凶。 千万不要相信 <code>robo3t</code> 自带的权限可视化操作，这是元凶。</p><p><strong>根本原因是 mongodb 加入了 SCRAM-SHA-1 校验方式</strong></p><p>删除原来的用户后用 <code>shell</code> 创建：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">db.</span><span style="color:#B392F0;">createUser</span><span style="color:#E1E4E8;">({ user: </span><span style="color:#9ECBFF;">&quot;admin&quot;</span><span style="color:#E1E4E8;">, pwd: </span><span style="color:#9ECBFF;">&quot;admin&quot;</span><span style="color:#E1E4E8;">, roles: [</span><span style="color:#9ECBFF;">&quot;root&quot;</span><span style="color:#E1E4E8;">] });</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">db.</span><span style="color:#6F42C1;">createUser</span><span style="color:#24292E;">({ user: </span><span style="color:#032F62;">&quot;admin&quot;</span><span style="color:#24292E;">, pwd: </span><span style="color:#032F62;">&quot;admin&quot;</span><span style="color:#24292E;">, roles: [</span><span style="color:#032F62;">&quot;root&quot;</span><span style="color:#24292E;">] });</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>登录 <code>shell</code> 可以用：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">mongo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">admin</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-u</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">root</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-p</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">123456</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">mongo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">admin</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-u</span><span style="color:#24292E;"> </span><span style="color:#032F62;">root</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-p</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">123456</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="复杂查询和数据聚合" tabindex="-1">复杂查询和数据聚合 <a class="header-anchor" href="#复杂查询和数据聚合" aria-label="Permalink to &quot;复杂查询和数据聚合&quot;">​</a></h2><p>普通查询这里不做阐述，看看文档很容易理解。这里主要讲一些高级查询。</p><h3 id="用-lookup-进行联合查询" tabindex="-1">用 $lookup 进行联合查询 <a class="header-anchor" href="#用-lookup-进行联合查询" aria-label="Permalink to &quot;用 \\$lookup 进行联合查询&quot;">​</a></h3><p>例如</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// member</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;测试用户&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;role&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;admin&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;sex&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;男&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;password&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// member</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;测试用户&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;role&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;admin&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;sex&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;男&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;password&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;0&quot;</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;AAA&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#79B8FF;">&quot;createDate&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2018-08-25&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;memberId&quot;</span><span style="color:#FDAEB7;font-style:italic;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;AAA&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#005CC5;">&quot;createDate&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2018-08-25&quot;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;memberId&quot;</span><span style="color:#B31D28;font-style:italic;">:</span><span style="color:#24292E;"> </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#B31D28;font-style:italic;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果要查询 project 的时候带出 member 的数据</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">db.</span><span style="color:#B392F0;">getCollection</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;project&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">aggregate</span><span style="color:#E1E4E8;">([</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $match: { projectName: projectName },</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $lookup: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      from: </span><span style="color:#9ECBFF;">&quot;member&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      localField: </span><span style="color:#9ECBFF;">&quot;memberId&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      foreignField: </span><span style="color:#9ECBFF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      as: </span><span style="color:#9ECBFF;">&quot;memberDetail&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">]);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">db.</span><span style="color:#6F42C1;">getCollection</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;project&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">aggregate</span><span style="color:#24292E;">([</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    $match: { projectName: projectName },</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    $lookup: {</span></span>
<span class="line"><span style="color:#24292E;">      from: </span><span style="color:#032F62;">&quot;member&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      localField: </span><span style="color:#032F62;">&quot;memberId&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      foreignField: </span><span style="color:#032F62;">&quot;_id&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      as: </span><span style="color:#032F62;">&quot;memberDetail&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="用-sort-进行排序" tabindex="-1">用 $sort 进行排序 <a class="header-anchor" href="#用-sort-进行排序" aria-label="Permalink to &quot;用 \\$sort 进行排序&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">db.</span><span style="color:#B392F0;">getCollection</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;project&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">aggregate</span><span style="color:#E1E4E8;">([</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        $match: { </span><span style="color:#9ECBFF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: projectName }</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      $lookup: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        from: </span><span style="color:#9ECBFF;">&quot;member&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        localField: </span><span style="color:#9ECBFF;">&quot;memberId&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        foreignField: </span><span style="color:#9ECBFF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        as: </span><span style="color:#9ECBFF;">&quot;memberDetail&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }，</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      $sort: { createDate: </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">db.</span><span style="color:#6F42C1;">getCollection</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;project&#39;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">aggregate</span><span style="color:#24292E;">([</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        $match: { </span><span style="color:#032F62;">&quot;projectName&quot;</span><span style="color:#24292E;">: projectName }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      $lookup: {</span></span>
<span class="line"><span style="color:#24292E;">        from: </span><span style="color:#032F62;">&quot;member&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        localField: </span><span style="color:#032F62;">&quot;memberId&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        foreignField: </span><span style="color:#032F62;">&quot;_id&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        as: </span><span style="color:#032F62;">&quot;memberDetail&quot;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }，</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      $sort: { createDate: </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="用-limit-进行限制条数" tabindex="-1">用 $limit 进行限制条数 <a class="header-anchor" href="#用-limit-进行限制条数" aria-label="Permalink to &quot;用 \\$limit 进行限制条数&quot;">​</a></h3><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">db.</span><span style="color:#B392F0;">getCollection</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;project&#39;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">aggregate</span><span style="color:#E1E4E8;">([</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">        $match: { </span><span style="color:#9ECBFF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: projectName }</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      $lookup: {</span></span>
<span class="line"><span style="color:#E1E4E8;">        from: </span><span style="color:#9ECBFF;">&quot;member&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        localField: </span><span style="color:#9ECBFF;">&quot;memberId&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        foreignField: </span><span style="color:#9ECBFF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        as: </span><span style="color:#9ECBFF;">&quot;memberDetail&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }，</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      $sort: { createDate: </span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;"> }</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      $limit: </span><span style="color:#79B8FF;">10</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">])</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">db.</span><span style="color:#6F42C1;">getCollection</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;project&#39;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">aggregate</span><span style="color:#24292E;">([</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">        $match: { </span><span style="color:#032F62;">&quot;projectName&quot;</span><span style="color:#24292E;">: projectName }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      $lookup: {</span></span>
<span class="line"><span style="color:#24292E;">        from: </span><span style="color:#032F62;">&quot;member&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        localField: </span><span style="color:#032F62;">&quot;memberId&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        foreignField: </span><span style="color:#032F62;">&quot;_id&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        as: </span><span style="color:#032F62;">&quot;memberDetail&quot;</span></span>
<span class="line"><span style="color:#24292E;">      }</span></span>
<span class="line"><span style="color:#24292E;">    }，</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      $sort: { createDate: </span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">1</span><span style="color:#24292E;"> }</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      $limit: </span><span style="color:#005CC5;">10</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">])</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>$limit 可以与 $skip 配合，达到分页查询的效果。</p></div><h3 id="用-unwind-扁平化数据" tabindex="-1">用 $unwind 扁平化数据 <a class="header-anchor" href="#用-unwind-扁平化数据" aria-label="Permalink to &quot;用 \\$unwind 扁平化数据&quot;">​</a></h3><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803b0a3beda646c35c050b&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;测试项目&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;startTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;endTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;desc&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;描述&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;members&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">, </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b8041043beda646c35c0609&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;测试项目2&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;startTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;endTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;desc&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;描述&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;members&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803b0a3beda646c35c050b&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;测试项目&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;startTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;endTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;desc&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;描述&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;members&quot;</span><span style="color:#24292E;">: [</span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">, </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b8041043beda646c35c0609&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;测试项目2&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;startTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;endTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;desc&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;描述&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;members&quot;</span><span style="color:#24292E;">: [</span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>扁平化处理：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">db.</span><span style="color:#B392F0;">getCollection</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;project&quot;</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">aggregate</span><span style="color:#E1E4E8;">([</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $unwind: </span><span style="color:#9ECBFF;">&quot;$members&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  },</span></span>
<span class="line"><span style="color:#E1E4E8;">]);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">db.</span><span style="color:#6F42C1;">getCollection</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;project&quot;</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">aggregate</span><span style="color:#24292E;">([</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    $unwind: </span><span style="color:#032F62;">&quot;$members&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  },</span></span>
<span class="line"><span style="color:#24292E;">]);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>输出结果：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803b0a3beda646c35c050b&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;测试项目&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;startTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;endTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;desc&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;描述&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;members&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803b0a3beda646c35c050b&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;测试项目&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;startTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;endTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;desc&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;描述&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;members&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">},</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;_id&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b8041043beda646c35c0609&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;测试项目2&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;startTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;endTime&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;desc&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;描述&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;members&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#FDAEB7;font-style:italic;">ObjectId(</span><span style="color:#9ECBFF;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#FDAEB7;font-style:italic;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803b0a3beda646c35c050b&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;测试项目&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;startTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;endTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;desc&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;描述&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;members&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803abf3beda646c35c0504&quot;</span><span style="color:#B31D28;font-style:italic;">)</span></span>
<span class="line"><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803b0a3beda646c35c050b&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;测试项目&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;startTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;endTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;desc&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;描述&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;members&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#B31D28;font-style:italic;">)</span></span>
<span class="line"><span style="color:#24292E;">},</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;_id&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b8041043beda646c35c0609&quot;</span><span style="color:#B31D28;font-style:italic;">)</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;测试项目2&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;startTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;endTime&quot;</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;desc&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;描述&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;members&quot;</span><span style="color:#24292E;">: </span><span style="color:#B31D28;font-style:italic;">ObjectId(</span><span style="color:#032F62;">&quot;5b803ef73beda646c35c05a6&quot;</span><span style="color:#B31D28;font-style:italic;">)</span></span>
<span class="line"><span style="color:#24292E;">})</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h2 id="复杂数据插入" tabindex="-1">复杂数据插入 <a class="header-anchor" href="#复杂数据插入" aria-label="Permalink to &quot;复杂数据插入&quot;">​</a></h2><h3 id="插入到子集合" tabindex="-1">插入到子集合 <a class="header-anchor" href="#插入到子集合" aria-label="Permalink to &quot;插入到子集合&quot;">​</a></h3><p>例如如下结构：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;AAA&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;createDate&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2018-08-25&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;tags&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;tag1&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;tag2&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;AAA&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;createDate&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2018-08-25&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;tags&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;tag1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;tag2&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果要插入一个 &quot;tag3&quot; 操作方式如下：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">project.</span><span style="color:#B392F0;">update</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  { projectName: </span><span style="color:#9ECBFF;">&quot;AAA&quot;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $addToSet: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      tags: </span><span style="color:#9ECBFF;">&quot;tag3&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">project.</span><span style="color:#6F42C1;">update</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  { projectName: </span><span style="color:#032F62;">&quot;AAA&quot;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    $addToSet: {</span></span>
<span class="line"><span style="color:#24292E;">      tags: </span><span style="color:#032F62;">&quot;tag3&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>结果：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;AAA&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;createDate&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2018-08-25&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;tags&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;tag1&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;tag2&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;tag3&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;AAA&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;createDate&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2018-08-25&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;tags&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;tag1&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;tag2&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;tag3&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="插入到子集合的子集合" tabindex="-1">插入到子集合的子集合 <a class="header-anchor" href="#插入到子集合的子集合" aria-label="Permalink to &quot;插入到子集合的子集合&quot;">​</a></h3><p>例如如下结构：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;AAA&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;createDate&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2018-08-25&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;children&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;BBB&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">&quot;children&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;A&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;B&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;AAA&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;createDate&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2018-08-25&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;children&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;BBB&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;children&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;A&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;B&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  ]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>如果要插入一个 &quot;C&quot; 操作方式如下：</p><div class="language-javascript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">project.</span><span style="color:#B392F0;">update</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">  { </span><span style="color:#9ECBFF;">&quot;children.name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;BBB&quot;</span><span style="color:#E1E4E8;"> },</span></span>
<span class="line"><span style="color:#E1E4E8;">  {</span></span>
<span class="line"><span style="color:#E1E4E8;">    $addToSet: {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#9ECBFF;">&quot;children.$.children&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;C&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    },</span></span>
<span class="line"><span style="color:#E1E4E8;">  }</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">project.</span><span style="color:#6F42C1;">update</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">  { </span><span style="color:#032F62;">&quot;children.name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;BBB&quot;</span><span style="color:#24292E;"> },</span></span>
<span class="line"><span style="color:#24292E;">  {</span></span>
<span class="line"><span style="color:#24292E;">    $addToSet: {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#032F62;">&quot;children.$.children&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;C&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    },</span></span>
<span class="line"><span style="color:#24292E;">  }</span></span>
<span class="line"><span style="color:#24292E;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>结果：</p><div class="language-json vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;projectName&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;AAA&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;createDate&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;2018-08-25&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">&quot;children&quot;</span><span style="color:#E1E4E8;">: [</span></span>
<span class="line"><span style="color:#E1E4E8;">    {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">&quot;name&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;BBB&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#79B8FF;">&quot;children&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;A&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;B&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;C&quot;</span><span style="color:#E1E4E8;">]</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">  ]</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// project</span></span>
<span class="line"><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;projectName&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;AAA&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;createDate&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;2018-08-25&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">&quot;children&quot;</span><span style="color:#24292E;">: [</span></span>
<span class="line"><span style="color:#24292E;">    {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;name&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;BBB&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#005CC5;">&quot;children&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;A&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;B&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;C&quot;</span><span style="color:#24292E;">]</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">  ]</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div>`,64),e=[o];function t(c,r,E,y,i,u){return n(),a("div",null,e)}const d=s(p,[["render",t]]);export{F as __pageData,d as default};
