import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.a1e87edc.js";const b=JSON.parse('{"title":"Android 问题笔记【持续更新】","description":"","frontmatter":{"title":"Android 问题笔记【持续更新】","catalog":true,"date":"2019-05-24T11:32:00.000Z","subtitle":null,"header-img":null,"tags":["Linux","Android","Cordova"]},"headers":[],"relativePath":"docs/frontend/hybird/android-q-note.md","filePath":"docs/frontend/hybird/android-q-note.md"}'),p={name:"docs/frontend/hybird/android-q-note.md"},o=l(`<h1 id="android-问题笔记【持续更新】" tabindex="-1">Android 问题笔记【持续更新】 <a class="header-anchor" href="#android-问题笔记【持续更新】" aria-label="Permalink to &quot;Android 问题笔记【持续更新】&quot;">​</a></h1><h2 id="dev-kvm-设备权限被拒绝的问题" tabindex="-1">/dev/kvm 设备权限被拒绝的问题 <a class="header-anchor" href="#dev-kvm-设备权限被拒绝的问题" aria-label="Permalink to &quot;/dev/kvm 设备权限被拒绝的问题&quot;">​</a></h2><p>在使用 AndroidStudio 时出现 <code>/dev/kvm</code> 设备权限被拒绝的问题，解决方案如下：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">sudo</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">chown</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">wolfx</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">/dev/kvm</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">sudo</span><span style="color:#24292E;"> </span><span style="color:#032F62;">chown</span><span style="color:#24292E;"> </span><span style="color:#032F62;">wolfx</span><span style="color:#24292E;"> </span><span style="color:#032F62;">/dev/kvm</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>wolfx 是我当前的登录名</p><h2 id="android-studio-报错显示-mips64el-linux-android-strip-找不到" tabindex="-1">Android Studio 报错显示 mips64el-linux-android-strip 找不到 <a class="header-anchor" href="#android-studio-报错显示-mips64el-linux-android-strip-找不到" aria-label="Permalink to &quot;Android Studio 报错显示 mips64el-linux-android-strip 找不到&quot;">​</a></h2><p>如果 ndk 版本在 r17 版, 很有可能出现这个问题. 我的解决方案是:</p><ul><li>先清除 <code>Android/Sdk/ndk-bundle/</code> 下的内容</li><li>从 <a href="https://developer.android.google.cn/ndk/downloads/older_releases" target="_blank" rel="noreferrer">https://developer.android.google.cn/ndk/downloads/older_releases</a> 下载 16b 版本的 ndk 到本地, 并解压说, 将解压缩后的所有文件拷贝到 Android/Sdk/ndk-bundle/ 目录下</li><li>重新 build 工程</li></ul><h2 id="android-默认签名与签名的-sha-1" tabindex="-1">Android 默认签名与签名的 SHA-1 <a class="header-anchor" href="#android-默认签名与签名的-sha-1" aria-label="Permalink to &quot;Android 默认签名与签名的 SHA-1&quot;">​</a></h2><p>在使用第三方服务时，经常会用到 <code>KeyStore SHA-1</code> 这里记录下获取方式。</p><h2 id="默认-keystore-存储路径" tabindex="-1">默认 KeyStore 存储路径 <a class="header-anchor" href="#默认-keystore-存储路径" aria-label="Permalink to &quot;默认 KeyStore 存储路径&quot;">​</a></h2><p>在 <code>Mac/Linux</code> 系统中，<code>debug.keystore</code> 文件默认储存在 <code>~/.android/</code> 路径下。</p><p>在 <code>Windows</code> 系统中，<code>debug.keystore</code> 文件将默认存储在 <code>C:\\Users\\{USERNAME}\\.android\\</code> 路径下。</p><h2 id="获取默认-keystore-sha-1" tabindex="-1">获取默认 KeyStore SHA-1 <a class="header-anchor" href="#获取默认-keystore-sha-1" aria-label="Permalink to &quot;获取默认 KeyStore SHA-1&quot;">​</a></h2><p>输入下面命令查看指纹信息：</p><div class="language-bash vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">keytool</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-list</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-v</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-keystore</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">~/.android/debug.keystore</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-alias</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">androiddebugkey</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-storepass</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">-keypass</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">android</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">keytool</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-list</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-v</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-keystore</span><span style="color:#24292E;"> </span><span style="color:#032F62;">~/.android/debug.keystore</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-alias</span><span style="color:#24292E;"> </span><span style="color:#032F62;">androiddebugkey</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-storepass</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">-keypass</span><span style="color:#24292E;"> </span><span style="color:#032F62;">android</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="新版-android-兼容处理" tabindex="-1">新版 android 兼容处理 <a class="header-anchor" href="#新版-android-兼容处理" aria-label="Permalink to &quot;新版 android 兼容处理&quot;">​</a></h2><h3 id="文件路径问题" tabindex="-1">文件路径问题 <a class="header-anchor" href="#文件路径问题" aria-label="Permalink to &quot;文件路径问题&quot;">​</a></h3><p>通过 <code>Uri.fromFile(file);</code> 获取的 <code>file://</code> 开头的路径，在新 android 上无权限使用。</p><p>解决方案是用 <code>FileProvider</code> 获得 <code>content://</code> 开头的路径。</p><p>首先在 manifest 中配置：</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;</span><span style="color:#85E89D;">provider</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">android:name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;android.support.v4.content.FileProvider&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">android:authorities</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;com.junl.fileprovider&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">android:exported</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#B392F0;">android:grantUriPermissions</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;true&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">meta-data</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">android:name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">android:resource</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;@xml/file_paths&quot;</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  &lt;/</span><span style="color:#85E89D;">provider</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">application</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">application</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;</span><span style="color:#22863A;">provider</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">android:name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;android.support.v4.content.FileProvider&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">android:authorities</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;com.junl.fileprovider&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">android:exported</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;false&quot;</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#6F42C1;">android:grantUriPermissions</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;true&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">meta-data</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">android:name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;android.support.FILE_PROVIDER_PATHS&quot;</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">android:resource</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;@xml/file_paths&quot;</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">  &lt;/</span><span style="color:#22863A;">provider</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">application</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在 <code>res/xml/file_paths.xml</code> 中添加</p><div class="language-xml vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;?</span><span style="color:#85E89D;">xml</span><span style="color:#B392F0;"> version</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;1.0&quot;</span><span style="color:#B392F0;"> encoding</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;utf-8&quot;</span><span style="color:#E1E4E8;">?&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">xmlns:android</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;http://schemas.android.com/apk/res/android&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">external-path</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;external_files&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">path</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;.&quot;</span><span style="color:#E1E4E8;">/&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">paths</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;?</span><span style="color:#22863A;">xml</span><span style="color:#6F42C1;"> version</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;1.0&quot;</span><span style="color:#6F42C1;"> encoding</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;utf-8&quot;</span><span style="color:#24292E;">?&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">paths</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">xmlns:android</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;http://schemas.android.com/apk/res/android&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">external-path</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;external_files&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">path</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;.&quot;</span><span style="color:#24292E;">/&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">paths</span><span style="color:#24292E;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>编写 Java 代码如下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> com.junl.cordova;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.content.Context;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.net.Uri;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.os.Build;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.support.v4.content.FileProvider;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> java.io.File;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Utils</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> Uri </span><span style="color:#B392F0;">getUriFromFile</span><span style="color:#E1E4E8;">(Context </span><span style="color:#FFAB70;">ctx</span><span style="color:#E1E4E8;">, File </span><span style="color:#FFAB70;">file</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Build.VERSION.SDK_INT </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> Build.VERSION_CODES.N) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">// 兼容 7.0</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> FileProvider.</span><span style="color:#B392F0;">getUriForFile</span><span style="color:#E1E4E8;">(ctx, </span><span style="color:#9ECBFF;">&quot;com.junl.fileprovider&quot;</span><span style="color:#E1E4E8;">, file);</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> Uri.</span><span style="color:#B392F0;">fromFile</span><span style="color:#E1E4E8;">(file);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> com.junl.cordova;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.content.Context;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.net.Uri;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.os.Build;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.support.v4.content.FileProvider;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> java.io.File;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Utils</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> Uri </span><span style="color:#6F42C1;">getUriFromFile</span><span style="color:#24292E;">(Context </span><span style="color:#E36209;">ctx</span><span style="color:#24292E;">, File </span><span style="color:#E36209;">file</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Build.VERSION.SDK_INT </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> Build.VERSION_CODES.N) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">// 兼容 7.0</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> FileProvider.</span><span style="color:#6F42C1;">getUriForFile</span><span style="color:#24292E;">(ctx, </span><span style="color:#032F62;">&quot;com.junl.fileprovider&quot;</span><span style="color:#24292E;">, file);</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> Uri.</span><span style="color:#6F42C1;">fromFile</span><span style="color:#24292E;">(file);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="权限问题" tabindex="-1">权限问题 <a class="header-anchor" href="#权限问题" aria-label="Permalink to &quot;权限问题&quot;">​</a></h3><p>新 android 的权限不仅仅要在 manifest 中申明，也需要在代码中授权：</p><p>写了个工具类如下：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> com.junl.cordova;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.Manifest;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.content.pm.PackageManager;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.os.Build;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.apache.cordova.CordovaActivity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PermissionUtil</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> PERMISSIONS_REQUEST </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> PERMISSION_GRANTED </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PackageManager.PERMISSION_GRANTED;</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">private</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">final</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[] Permission </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">String</span><span style="color:#E1E4E8;">[]{</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.ACCESS_COARSE_LOCATION, </span><span style="color:#6A737D;">// 用于进行网络定位</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.ACCESS_FINE_LOCATION, </span><span style="color:#6A737D;">// 用于访问GPS定位</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.ACCESS_LOCATION_EXTRA_COMMANDS, </span><span style="color:#6A737D;">// 用于访问A-GPS定位</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.ACCESS_NETWORK_STATE, </span><span style="color:#6A737D;">// 用于获取运营商信息，用于支持提供运营商信息相关的接口</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.ACCESS_WIFI_STATE, </span><span style="color:#6A737D;">// 用于访问wifi网络信息，wifi信息会用于进行网络定位</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.CHANGE_WIFI_STATE, </span><span style="color:#6A737D;">// 用于获取wifi的获取权限，wifi信息会用来进行网络定位</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.INTERNET, </span><span style="color:#6A737D;">// 用于访问网络，网络定位需要上网</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.READ_PHONE_STATE, </span><span style="color:#6A737D;">// 用于读取手机当前的状态</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.WRITE_EXTERNAL_STORAGE, </span><span style="color:#6A737D;">// 用于写入缓存数据到扩展存储卡</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.READ_EXTERNAL_STORAGE,</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.BLUETOOTH,</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.BLUETOOTH_ADMIN,</span></span>
<span class="line"><span style="color:#E1E4E8;">            Manifest.permission.CAMERA,</span></span>
<span class="line"><span style="color:#E1E4E8;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/* 判断程序是否有所需权限 android22 以上需要自申请权限 */</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">boolean</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">hasPermission</span><span style="color:#E1E4E8;">(CordovaActivity </span><span style="color:#FFAB70;">cordovaActivity</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Build.VERSION.SDK_INT </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> Build.VERSION_CODES.M) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">for</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">int</span><span style="color:#E1E4E8;"> i </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">; i </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> Permission.length; i</span><span style="color:#F97583;">++</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (cordovaActivity.</span><span style="color:#B392F0;">checkSelfPermission</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">Permission</span><span style="color:#E1E4E8;">[i]) </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> PERMISSION_GRANTED) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">                }</span></span>
<span class="line"><span style="color:#E1E4E8;">            }</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        } </span><span style="color:#F97583;">else</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">/* 请求程序所需权限 */</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">static</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">requestPermission</span><span style="color:#E1E4E8;">(CordovaActivity </span><span style="color:#FFAB70;">cordovaActivity</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (Build.VERSION.SDK_INT </span><span style="color:#F97583;">&gt;=</span><span style="color:#E1E4E8;"> Build.VERSION_CODES.M) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            cordovaActivity.</span><span style="color:#B392F0;">requestPermissions</span><span style="color:#E1E4E8;">(Permission, PERMISSIONS_REQUEST);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> com.junl.cordova;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.Manifest;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.content.pm.PackageManager;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.os.Build;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.apache.cordova.CordovaActivity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PermissionUtil</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> PERMISSIONS_REQUEST </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> PERMISSION_GRANTED </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PackageManager.PERMISSION_GRANTED;</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">private</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">final</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[] Permission </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">String</span><span style="color:#24292E;">[]{</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.ACCESS_COARSE_LOCATION, </span><span style="color:#6A737D;">// 用于进行网络定位</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.ACCESS_FINE_LOCATION, </span><span style="color:#6A737D;">// 用于访问GPS定位</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.ACCESS_LOCATION_EXTRA_COMMANDS, </span><span style="color:#6A737D;">// 用于访问A-GPS定位</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.ACCESS_NETWORK_STATE, </span><span style="color:#6A737D;">// 用于获取运营商信息，用于支持提供运营商信息相关的接口</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.ACCESS_WIFI_STATE, </span><span style="color:#6A737D;">// 用于访问wifi网络信息，wifi信息会用于进行网络定位</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.CHANGE_WIFI_STATE, </span><span style="color:#6A737D;">// 用于获取wifi的获取权限，wifi信息会用来进行网络定位</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.INTERNET, </span><span style="color:#6A737D;">// 用于访问网络，网络定位需要上网</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.READ_PHONE_STATE, </span><span style="color:#6A737D;">// 用于读取手机当前的状态</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.WRITE_EXTERNAL_STORAGE, </span><span style="color:#6A737D;">// 用于写入缓存数据到扩展存储卡</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.READ_EXTERNAL_STORAGE,</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.BLUETOOTH,</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.BLUETOOTH_ADMIN,</span></span>
<span class="line"><span style="color:#24292E;">            Manifest.permission.CAMERA,</span></span>
<span class="line"><span style="color:#24292E;">    };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/* 判断程序是否有所需权限 android22 以上需要自申请权限 */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">boolean</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">hasPermission</span><span style="color:#24292E;">(CordovaActivity </span><span style="color:#E36209;">cordovaActivity</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Build.VERSION.SDK_INT </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> Build.VERSION_CODES.M) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">for</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">int</span><span style="color:#24292E;"> i </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0</span><span style="color:#24292E;">; i </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> Permission.length; i</span><span style="color:#D73A49;">++</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (cordovaActivity.</span><span style="color:#6F42C1;">checkSelfPermission</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">Permission</span><span style="color:#24292E;">[i]) </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> PERMISSION_GRANTED) {</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">                }</span></span>
<span class="line"><span style="color:#24292E;">            }</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        } </span><span style="color:#D73A49;">else</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">/* 请求程序所需权限 */</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">static</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">requestPermission</span><span style="color:#24292E;">(CordovaActivity </span><span style="color:#E36209;">cordovaActivity</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (Build.VERSION.SDK_INT </span><span style="color:#D73A49;">&gt;=</span><span style="color:#24292E;"> Build.VERSION_CODES.M) {</span></span>
<span class="line"><span style="color:#24292E;">            cordovaActivity.</span><span style="color:#6F42C1;">requestPermissions</span><span style="color:#24292E;">(Permission, PERMISSIONS_REQUEST);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>在 Activity 中调用：</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">package</span><span style="color:#E1E4E8;"> com.example.hello;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> android.os.Bundle;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> com.junl.cordova.PermissionUtil;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> org.apache.cordova.CordovaActivity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">class</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">MainActivity</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">extends</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CordovaActivity</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    @</span><span style="color:#F97583;">Override</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">public</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">void</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">onCreate</span><span style="color:#E1E4E8;">(Bundle </span><span style="color:#FFAB70;">savedInstanceState</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#79B8FF;">super</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">onCreate</span><span style="color:#E1E4E8;">(savedInstanceState);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// 允许 Cordova 后台运行</span></span>
<span class="line"><span style="color:#E1E4E8;">        Bundle extras </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getIntent</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">getExtras</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (extras </span><span style="color:#F97583;">!=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">null</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">&amp;&amp;</span><span style="color:#E1E4E8;"> extras.</span><span style="color:#B392F0;">getBoolean</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;cdvStartInBackground&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">false</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#B392F0;">moveTaskToBack</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">/* 申请程序所需权限 */</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (</span><span style="color:#F97583;">!</span><span style="color:#E1E4E8;">PermissionUtil.</span><span style="color:#B392F0;">hasPermission</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">)) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            PermissionUtil.</span><span style="color:#B392F0;">requestPermission</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">loadUrl</span><span style="color:#E1E4E8;">(launchUrl);</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#6A737D;">// loadUrl(&quot;https://www.baidu.com&quot;);</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">package</span><span style="color:#24292E;"> com.example.hello;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> android.os.Bundle;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> com.junl.cordova.PermissionUtil;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> org.apache.cordova.CordovaActivity;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">class</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">MainActivity</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">extends</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CordovaActivity</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    @</span><span style="color:#D73A49;">Override</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">public</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">void</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">onCreate</span><span style="color:#24292E;">(Bundle </span><span style="color:#E36209;">savedInstanceState</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#005CC5;">super</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">onCreate</span><span style="color:#24292E;">(savedInstanceState);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// 允许 Cordova 后台运行</span></span>
<span class="line"><span style="color:#24292E;">        Bundle extras </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getIntent</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">getExtras</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (extras </span><span style="color:#D73A49;">!=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">null</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">&amp;&amp;</span><span style="color:#24292E;"> extras.</span><span style="color:#6F42C1;">getBoolean</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;cdvStartInBackground&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">false</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6F42C1;">moveTaskToBack</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">/* 申请程序所需权限 */</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (</span><span style="color:#D73A49;">!</span><span style="color:#24292E;">PermissionUtil.</span><span style="color:#6F42C1;">hasPermission</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">)) {</span></span>
<span class="line"><span style="color:#24292E;">            PermissionUtil.</span><span style="color:#6F42C1;">requestPermission</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">loadUrl</span><span style="color:#24292E;">(launchUrl);</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6A737D;">// loadUrl(&quot;https://www.baidu.com&quot;);</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="拍照裁剪保存问题" tabindex="-1">拍照裁剪保存问题 <a class="header-anchor" href="#拍照裁剪保存问题" aria-label="Permalink to &quot;拍照裁剪保存问题&quot;">​</a></h3><p>需要添加 <code>addFlags</code> 兼容高版本</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 剪裁</span></span>
<span class="line"><span style="color:#E1E4E8;">Intent crop </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Intent</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;com.android.camera.action.CROP&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">setDataAndType</span><span style="color:#E1E4E8;">(fileUri, </span><span style="color:#9ECBFF;">&quot;image/*&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;scale&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 设置宽高比例</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;aspectX&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;aspectY&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 设置裁剪图片宽高</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;outputX&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">340</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;outputY&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">340</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">putExtra</span><span style="color:#E1E4E8;">(MediaStore.EXTRA_OUTPUT, fileUri);</span></span>
<span class="line"><span style="color:#6A737D;">// 高版本系统需要 addFlags</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">addFlags</span><span style="color:#E1E4E8;">(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span></span>
<span class="line"><span style="color:#E1E4E8;">crop.</span><span style="color:#B392F0;">addFlags</span><span style="color:#E1E4E8;">(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 剪裁</span></span>
<span class="line"><span style="color:#24292E;">Intent crop </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Intent</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;com.android.camera.action.CROP&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">setDataAndType</span><span style="color:#24292E;">(fileUri, </span><span style="color:#032F62;">&quot;image/*&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;scale&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 设置宽高比例</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;aspectX&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;aspectY&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#6A737D;">// 设置裁剪图片宽高</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;outputX&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">340</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;outputY&quot;</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">340</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">putExtra</span><span style="color:#24292E;">(MediaStore.EXTRA_OUTPUT, fileUri);</span></span>
<span class="line"><span style="color:#6A737D;">// 高版本系统需要 addFlags</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">addFlags</span><span style="color:#24292E;">(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</span></span>
<span class="line"><span style="color:#24292E;">crop.</span><span style="color:#6F42C1;">addFlags</span><span style="color:#24292E;">(Intent.FLAG_GRANT_READ_URI_PERMISSION);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div>`,35),e=[o];function r(c,t,E,i,y,d){return n(),a("div",null,e)}const F=s(p,[["render",r]]);export{b as __pageData,F as default};
