import{_ as s,o as a,c as n,X as l}from"./chunks/framework.405fef80.js";const b=JSON.parse('{"title":"CentOS 7 FAQ","description":"","frontmatter":{"title":"CentOS 7 FAQ","catalog":true,"date":"2018-05-12T21:10:00.000Z","subtitle":null,"header-img":null,"tags":["Linux"],"recommend":"CentOS"},"headers":[],"relativePath":"docs/os/centos-7-faq.md","filePath":"docs/os/centos-7-faq.md"}'),p={name:"docs/os/centos-7-faq.md"},e=l(`<h1 id="centos-7-faq" tabindex="-1">CentOS 7 FAQ <a class="header-anchor" href="#centos-7-faq" aria-label="Permalink to &quot;CentOS 7 FAQ&quot;">​</a></h1><blockquote><p>本来一直用的 ArchLinux，不过 Arch 其实不适合作为服务器使用，因为其滚动更新的特性使得服务器不稳定。</p></blockquote><h2 id="centos-如何安装最新版本的-gcc-编译器" tabindex="-1">CentOS 如何安装最新版本的 GCC 编译器 <a class="header-anchor" href="#centos-如何安装最新版本的-gcc-编译器" aria-label="Permalink to &quot;CentOS 如何安装最新版本的 GCC 编译器&quot;">​</a></h2><p>默认没做任何设置的情况下，yum 安装的 GCC 版本比较陈旧。如果想安装较新的版本，需要如下操作：</p><h3 id="gcc-4-9-安装" tabindex="-1">GCC 4.9 安装 <a class="header-anchor" href="#gcc-4-9-安装" aria-label="Permalink to &quot;GCC 4.9 安装&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos-release-scl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">devtoolset-3-toolchain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#FFCB6B;">scl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">devtoolset-3</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">gcc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-v</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="gcc-5-2-安装" tabindex="-1">GCC 5.2 安装 <a class="header-anchor" href="#gcc-5-2-安装" aria-label="Permalink to &quot;GCC 5.2 安装&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">centos-release-scl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">devtoolset-4-toolchain</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-y</span></span>
<span class="line"><span style="color:#FFCB6B;">scl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">devtoolset-4</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">bash</span></span>
<span class="line"><span style="color:#FFCB6B;">gcc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--version</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="centos7-安装完毕后无法联网的解决方法" tabindex="-1">Centos7 安装完毕后无法联网的解决方法 <a class="header-anchor" href="#centos7-安装完毕后无法联网的解决方法" aria-label="Permalink to &quot;Centos7 安装完毕后无法联网的解决方法&quot;">​</a></h2><p>进入目录：</p><p><code>/etc/sysconfig/network-scripts/</code></p><p>ls 命令查看网卡配置文件名（在 CENTOS7 中网卡名貌似变成了随机数字，所以每台机器的网卡名并不相同）</p><p>比如：<code>ifcfg-enoxxxxxx</code></p><p>将最后一行的 ONBOOT=no 改为 ONBOOT=yes, 如图 最后输入：wq 保存并退出，再重启一下 network：</p><p><code>service network restart</code></p><h2 id="如何增加桌面环境" tabindex="-1">如何增加桌面环境 <a class="header-anchor" href="#如何增加桌面环境" aria-label="Permalink to &quot;如何增加桌面环境&quot;">​</a></h2><p>KDE</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">groupinstall</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">KDE Plasma Workspaces</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>GNOME</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">groupinstall</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GNOME Desktop</span><span style="color:#89DDFF;">&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>启动（基于 systemd)</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get-default</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">set-default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">graphical.target</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="yum-和-rpm-常用命令备忘录" tabindex="-1">Yum 和 RPM 常用命令备忘录 <a class="header-anchor" href="#yum-和-rpm-常用命令备忘录" aria-label="Permalink to &quot;Yum 和 RPM 常用命令备忘录&quot;">​</a></h2><p>yum history</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">list</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">I</span><span style="color:#A6ACCD;">D</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">info</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">I</span><span style="color:#A6ACCD;">D</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">undo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">I</span><span style="color:#A6ACCD;">D</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">history</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">redo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">I</span><span style="color:#A6ACCD;">D</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>yum update</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clean</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">all</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">makecache</span></span>
<span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">update</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>rpm 安装卸载</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-ivh</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.rpm</span></span>
<span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-qa</span></span>
<span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-qa</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span></span>
<span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span></span>
<span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-e</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--nodeps</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="如何从-yum-库下载-rpm-包但不安装" tabindex="-1">如何从 Yum 库下载 rpm 包但不安装 <a class="header-anchor" href="#如何从-yum-库下载-rpm-包但不安装" aria-label="Permalink to &quot;如何从 Yum 库下载 rpm 包但不安装&quot;">​</a></h2><h3 id="方法一-yum" tabindex="-1">方法一：yum <a class="header-anchor" href="#方法一-yum" aria-label="Permalink to &quot;方法一：yum&quot;">​</a></h3><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--downloadonly</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">package-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>默认情况下，一个下载的 RPM 包会保存在下面的目录中： <code>/var/cache/yum/x86_64/[centos/fedora-version]/[repository]/packages</code> 以上的 <code>[repository]</code> 表示下载包的来源仓库的名称（例如：base、fedora、updates)</p><p>如果你想要将一个包下载到一个指定的目录（如 /tmp)：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--downloadonly</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--downloaddir=/tmp</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">package-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注意，如果下载的包包含了任何没有满足的依赖关系，yum 将会把所有的依赖关系包下载，但是都不会被安装。 另外一个重要的事情是，在 <code>CentOS/RHEL 6</code> 或更早期的版本中，你需要安装一个单独 yum 插件（名称为 <code>yum-plugin-downloadonly</code>) 才能使用 <code>--downloadonly</code> 命令选项：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum-plugin-downloadonly</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>如果没有该插件，你会在使用 yum 时得到以下错误：</p><p><code>Command line error: no such option: --downloadonly</code></p><h3 id="方法二-yumdownloader" tabindex="-1">方法二：Yumdownloader <a class="header-anchor" href="#方法二-yumdownloader" aria-label="Permalink to &quot;方法二：Yumdownloader&quot;">​</a></h3><p>另外一个下载 RPM 包的方法就是通过一个专门的包下载工具 --yumdownloader。 这个工具是 yum 工具包（包含了用来进行 yum 包管理的帮助工具套件) 的子集。</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yum-utils</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>下载一个 RPM 包：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yumdownloader</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#C3E88D;">package-nam</span><span style="color:#A6ACCD;">e</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>下载的包会被保存在当前目录中。你需要使用 root 权限，因为 yumdownloader 会在下载过程中更新包索引文件。与 yum 命令不同的是，任何依赖包不会被下载。</p><p>下载 lsof 示例：</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yumdownloader</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">lsof</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--resolve</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--destdir=/data/mydepot/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>--resolve</code> 表示为下载依赖</p><h2 id="centos-samba-服务器配置" tabindex="-1">CentOS Samba 服务器配置 <a class="header-anchor" href="#centos-samba-服务器配置" aria-label="Permalink to &quot;CentOS Samba 服务器配置&quot;">​</a></h2><p>Samba 是 SMB 的一种实现方法，主要用来实现 Linux 系统的文件和打印服务。Linux 用户通过配置使用 Samba 服务器可以实现与 Windows 用户的资源共享。守护进程 smbd 和 nmbd 是 Samba 的核心，在全部时间内运行。nmbd 程序使得通过企图计算机可以浏览 Linux 服务器。</p><h3 id="一、安装前准备" tabindex="-1">一、安装前准备 <a class="header-anchor" href="#一、安装前准备" aria-label="Permalink to &quot;一、安装前准备&quot;">​</a></h3><p>1、 使用 Samba 服务器需要防火墙开放以下端口</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">UDP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">137</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">UDP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">138</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">TCP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">139</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">TCP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">445</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## 配置防火墙端口</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/sysconfig/iptables</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">-A</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">INPUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NEW</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dport</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">139</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ACCEPT</span></span>
<span class="line"><span style="color:#FFCB6B;">-A</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">INPUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NEW</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dport</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">445</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ACCEPT</span></span>
<span class="line"><span style="color:#FFCB6B;">-A</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">INPUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NEW</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">udp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">udp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dport</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">137</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ACCEPT</span></span>
<span class="line"><span style="color:#FFCB6B;">-A</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">INPUT</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--state</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">NEW</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-m</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">udp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">udp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--dport</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">138</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-j</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ACCEPT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## 重启防火墙，使规则生效</span></span>
<span class="line"><span style="color:#FFCB6B;">/etc/rc.d/init.d/iptables</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>2、关闭 CentOS6 系统的 SELinux</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/selinux/config</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## SELINUX=enforcing     #注释掉</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## SELINUXTYPE=targeted  #注释掉</span></span>
<span class="line"><span style="color:#A6ACCD;">SELINUX</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">disabled</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;">#增加</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## :wq  保存。</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## 重启系统</span></span>
<span class="line"><span style="color:#FFCB6B;">shutdown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">now</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">或者</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h3 id="二、安装-samba" tabindex="-1">二、安装 Samba <a class="header-anchor" href="#二、安装-samba" aria-label="Permalink to &quot;二、安装 Samba&quot;">​</a></h3><p>1 、检查 Samba 服务包是否已安装</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-qa</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">grep</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">samba</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">samba-3.5.4-68.el6.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">samba-common-3.5.4-68.el6.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">samba-client-3.5.4-68.el6.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">samba4-libs-4.0.0-23.alpha11.el6.x86_64</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">samba-winbind-clients-3.5.4-68.el6.x86_64</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>说明 samba 已经安装，如果没有安装，运行下面命令安装</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">root@ www </span><span style="color:#89DDFF;">~]</span><span style="color:#A6ACCD;"> yum install samba</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>2、配置 samba</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">smb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">on</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">## 设置 Samba 开机自动启动</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">smb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">start</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;">## 启动 Samba 服务</span></span>
<span class="line"><span style="color:#FFCB6B;">/etc/init.d/smb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;">  </span><span style="color:#676E95;font-style:italic;">## 重启</span></span>
<span class="line"><span style="color:#FFCB6B;">/etc/init.d/smb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">## 停止</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/samba/smb.conf</span><span style="color:#A6ACCD;">   </span><span style="color:#C3E88D;">/etc/samba/bak_smb.conf_bak</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">## 备份</span></span>
<span class="line"><span style="color:#FFCB6B;">cp</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/samba/bak_smb.conf_bak</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">/etc/samba/smb.conf</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">## 恢复</span></span>
<span class="line"><span style="color:#FFCB6B;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/samba/smb.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">global</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                           </span><span style="color:#676E95;font-style:italic;">## 找到这一行（全局设置标签），在此行下面添加如下行：</span></span>
<span class="line"><span style="color:#FFCB6B;">workgroup</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WORKGROUP</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;">## 工作组名称改为 Windows 网络所定义的工作组名</span></span>
<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Samba</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Server</span><span style="color:#A6ACCD;">   </span><span style="color:#676E95;font-style:italic;">## 设置 samba 服务器的主机名称</span></span>
<span class="line"><span style="color:#FFCB6B;">security</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">user</span><span style="color:#A6ACCD;">                </span><span style="color:#676E95;font-style:italic;">## 设置 samba 服务器安全级别为 user，即以账号和口令访问</span></span>
<span class="line"><span style="color:#FFCB6B;">netbios</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">name</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SambaServer</span><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;">## 设置 Samba 服务器访问别名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#在配置文件的末尾添加以下自定义内容</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">SambaServer</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;">                      </span><span style="color:#676E95;font-style:italic;">## 在 Windows 网上邻居中看到的共享目录的名字</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">comment</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SambaServer</span><span style="color:#A6ACCD;">          </span><span style="color:#676E95;font-style:italic;">## 在 Windows 网上邻居中看到的共享目录的备注信息</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/home/SambaServer</span><span style="color:#A6ACCD;">       </span><span style="color:#676E95;font-style:italic;">## 共享目录在系统中的位置</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">no</span><span style="color:#A6ACCD;">                    </span><span style="color:#676E95;font-style:italic;">## 不公开目录</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">writable</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">yes</span><span style="color:#A6ACCD;">                 </span><span style="color:#676E95;font-style:italic;">## 共享目录可以读写</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">valid</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">users=SambaServer</span><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;">## 只允许 SambaServer 用户访问</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## 保存配置</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>3、添加访问 linux 共享目录的账号 SambaServer</p><p>用户家目录为 /home/SambaServer, 用户登录终端设为 /bin/false（即使之不能登录系统)</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/home/SambaServer</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">#建立 SambaServer 文件夹</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/home/SambaServer</span></span>
<span class="line"><span style="color:#FFCB6B;">touch</span><span style="color:#A6ACCD;">  </span><span style="color:#C3E88D;">samba.txt</span><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;">#创建测试文件 samba.txt</span></span>
<span class="line"><span style="color:#FFCB6B;">useradd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SambaServer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/home/SambaServer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/bin/</span><span style="color:#89DDFF;">false</span></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SambaServer:SambaServer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/home/SambaServer</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-R</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>4、将用户 SambaServer 添加入到 Samba 用户数据库，并设置登录共享目录的密码为：123456</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">smbpasswd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-a</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SambaServer</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">New</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SMB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">password:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">## 输入该用户用于登录 Samba 的密码</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">Retype</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SMB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">password:</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">## 再次确认输入该密码</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#FFCB6B;">Added</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">user</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SambaServer.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## 备注：这里设置的密码是 SambaServer 用户登录该机的 Samba 共享的密码，非登陆 OS 的密码；</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>5、重启 Samba 服务器</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">/etc/init.d/smb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>6、浏览共享信息 在 Windows 客户端输入 <code>\\\\ip</code> 或者 <code>\\\\SambaServer</code> 服务器别名</p><p>回车之后，会跳出来登录框，输入账号 SambaServer , 密码 123456 , 即可访问共享目录</p><p>至此，CentOS 6 linux samba 服务器配置完成。</p><p>服务名：smb 配置目录：<code>/etc/sabma/</code> 主配置文件：<code>/etc/sabma/smb.conf</code></p><p>问题： 如果无法访问共享目录的内容，请把防火墙停止；</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">iptables</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h2 id="「rpm」error-in-preun-scriptlet-file-was-supposed-to-be-removed-but-is-not" tabindex="-1">「RPM」Error in PREUN scriptlet … file was supposed to be removed but is not <a class="header-anchor" href="#「rpm」error-in-preun-scriptlet-file-was-supposed-to-be-removed-but-is-not" aria-label="Permalink to &quot;「RPM」Error in PREUN scriptlet … file was supposed to be removed but is not&quot;">​</a></h2><blockquote><p><a href="http://www.linux-pages.com/2012/08/error-in-preun-scriptlet-file-was-supposed-to-be-removed-but-is-not/" target="_blank" rel="noreferrer">http://www.linux-pages.com/2012/08/error-in-preun-scriptlet-file-was-supposed-to-be-removed-but-is-not/</a></p></blockquote><p>Sometimes a yum/RPM package would get “stuck” and just won’t go away. Actually usually the package is already gone but yum/rpm fails to update it’s internal DB and still thinks it is there.</p><p>The error one usually sees in such cases is something like:</p><div class="language-bash line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">Error</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PREUN</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">scriptlet</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">rpm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">package</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stlinux23-sh4_uclibc-which</span></span>
<span class="line"><span style="color:#FFCB6B;">stlinux23-sh4_uclibc-which-2.16-5.sh4_uclibc</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">was</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">supposed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">be</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">removed</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">but</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">not!</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>So in my case the package stlinux23-sh4_uclibc-which-2.16-5.sh4_uclibc is causing problems, it will be soemthing different in your case</p><p>To fix the problem run:</p><p><code>yum --setopt=tsflags=noscripts remove stlinux23-sh4_uclibc-which.sh4_uclibc</code></p><p>You can add more than one package file to the end of the command.</p><h2 id="「java」org-quartz-schedulerexception-couldn-t-get-host-name" tabindex="-1">「Java」org.quartz.SchedulerException: Couldn&#39;t get host name! <a class="header-anchor" href="#「java」org-quartz-schedulerexception-couldn-t-get-host-name" aria-label="Permalink to &quot;「Java」org.quartz.SchedulerException: Couldn&#39;t get host name!&quot;">​</a></h2><blockquote><p>&lt;<a href="https://blog.csdn.net/Lumia10200/article/details/52670231" target="_blank" rel="noreferrer">https://blog.csdn.net/Lumia10200/article/details/52670231</a> &gt;</p></blockquote><p>使用 quartz 做集群任务的时候，在本地和测试环境正常，部署上线的时候， 启动异常：org.quartz.SchedulerException: Couldn&#39;t get host name!</p><p>这个是 org.quartz.simpl.SimpleInstanceIdGenerator 中获取主机名异常了</p><div class="language-java line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">SimpleInstanceIdGenerator</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">implements</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">InstanceIdGenerator</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">generateInstanceId</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">throws</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SchedulerException</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> InetAddress</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getLocalHost</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getHostName</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> System</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">currentTimeMillis</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Exception</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">SchedulerException</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Couldn&#39;t get host name!</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> e</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>处理方法:</p><p>进入线上环境(centOs6.x):</p><p>1, 查看主机名(命令) : hostname</p><p>2, 打开 hosts 文件: <code>vi /etc/hosts</code> 查看是否有乱码等异常内容</p><p>3, 确保有: 127.0.0.1 后跟上面用 hostname 命令查看到的主机名， 如果没有则加上</p><p>如 : hostname -&gt; USER-1234</p><p>则: 127.0.0.1 USER-1234</p><p>程序正常， 定时任务正常</p>`,99),o=[e];function t(r,c,C,i,y,A){return a(),n("div",null,o)}const d=s(p,[["render",t]]);export{b as __pageData,d as default};
